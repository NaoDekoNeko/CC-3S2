<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Ademar\OneDrive\Desktop\Practica1-C3S2\Sprint5\ReSOSgame\ReSOSgame\Game.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using static ReSOSgame.Tablero;

namespace ReSOSgame
{
    public abstract class Game
    {
        public Tablero tablero;
        public ScoreValidator validator;

        public Game(Tablero tablero)
        {
            this.tablero = tablero;
            validator = new ScoreValidator(tablero);
        }

        //public int Tamanio =&gt; tablero.Tamanio;
        public abstract void FinalGameState(); // Funcion que indica el estado final del game
        public abstract void MakeMove(int row, int col, Cell ficha); // Funcion para realizar un movimiento
    }

    public class SimpleGame : Game
    {
        public SimpleGame(Tablero tablero) : base(tablero)
        {
        }

        // Funcion que verifica si se ha ganado el game simple
        // Funcion que actualiza el estado del game Simple 
        public override void FinalGameState()
        {
            if (validator.FullBoard())
                tablero.EstadoDeJuego = GameState.EMPATE;
            else
                tablero.EstadoDeJuego =
                    tablero.Turno == Jugador.JAZUL
                        ? GameState.GANOAZUL
                        : GameState.GANOROJO; // Cambia el estado del tablero
        }

        public override void MakeMove(int row, int column, Cell _ficha)
        {
            if (!validator.GameOver()) // Si es el estado de game es JUGANDO
            {
                if (isOnBoard(row, column) &amp;&amp;
                    isEmpty(row, column)) // Si la posicion :[row,column] esta en el trablero y esa posicion esta vacia
                {
                    tablero.ValidMove = true; // El atributo ValidMove es verdadero. 
                    tablero.Ficha = _ficha; // rellena el atributo Ficha
                    tablero.Grid[row, column] = _ficha; // rellena el grid del tablero con ficha
                    if (validator.HasOnePoint(row, column, tablero.Ficha) ||
                        validator.FullBoard()) // Cuando se ha hecho ganado 1 punto o esta el tablero lleno
                        FinalGameState(); // Actualiza el estado final del tablero
                    if (tablero.EstadoDeJuego == GameState.JUGANDO) // Si el estado de game es JUGANDO entonces ...
                        tablero.Turno =
                            tablero.Turno == Jugador.JAZUL
                                ? Jugador.JROJO
                                : Jugador.JAZUL; // Se hace el cambio de turno
                }
                else
                {
                    tablero.ValidMove = false;
                }
            }
            else
            {
                tablero.ValidMove = false;
            }
        }

        private bool isOnBoard(int row, int column)
        {
            return row &gt;= 0 &amp;&amp; row &lt; tablero.Tamanio &amp;&amp; column &gt;= 0 &amp;&amp; column &lt; tablero.Tamanio;
        }

        private bool isEmpty(int row, int column)
        {
            return tablero.GetCell(row, column) == 0;
        }
    }


    public class GeneralGame : Game
    {
        // Atributos para tener los puntajes de cada jugador

        public GeneralGame(Tablero tablero) : base(tablero)
        {
        }

        public int PuntajeAzul { get; private set; }

        public int PuntajeRojo { get; private set; }
        // Funcion que verifica si se ha ganado en un Game General

        public override void FinalGameState() // Calcula el estado final comparando los puntajes
        {
            if (PuntajeAzul &gt; PuntajeRojo)
                tablero.EstadoDeJuego = GameState.GANOAZUL; // Establece que el azul ha ganado
            else if (PuntajeAzul &lt; PuntajeRojo)
                tablero.EstadoDeJuego = GameState.GANOROJO; // Establece que el rojo ha ganado
            else if
                (PuntajeRojo == PuntajeAzul)
                tablero.EstadoDeJuego = GameState.EMPATE; // Establece que ha habido un empate
            //sino, el estado de game es JUGANDO
        }

        public override void MakeMove(int row, int column, Cell _ficha)
        {
            if (!validator.GameOver())
            {
                if (row &gt;= 0 &amp;&amp; row &lt; tablero.Tamanio &amp;&amp; column &gt;= 0 &amp;&amp; column &lt; tablero.Tamanio
                    &amp;&amp; tablero.Grid[row, column] == 0)
                {
                    tablero.ValidMove = true;
                    tablero.Ficha = _ficha;
                    tablero.Grid[row, column] = _ficha;
                    if (validator.HasOnePoint(row, column, tablero.Ficha)) // Si se ha obtenido un punto
                    {
                        //en el turno del jugador JAZUL
                        if (tablero.Turno == Jugador.JAZUL)
                            PuntajeAzul++; // Se agrega un punto al jugador Azul
                        //en el turno del jugador JROJO
                        else
                            PuntajeRojo++; // Se agrega un punto al jugador Rojo
                    }

                    if (validator.FullBoard())
                        FinalGameState(); // Actualiza el estado del game cuando el tablero esta lleno
                    // Nota: esa funcion detiene el cambio de turno cuando ya se halla ganado o empatado
                    if (tablero.EstadoDeJuego == GameState.JUGANDO) // Si se sigue jugando
                        tablero.Turno =
                            tablero.Turno == Jugador.JAZUL
                                ? Jugador.JROJO
                                : Jugador.JAZUL; // Se cambia de turno al jugador contrario
                }
            }
            else
            {
                tablero.ValidMove = false;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[10,9,10,37,0],[11,9,11,10,0],[12,13,12,36,0],[13,13,13,53,0],[14,9,14,10,0],[23,46,23,59,0],[24,9,24,10,0],[25,9,25,10,0],[30,9,30,10,0],[31,13,31,39,0],[32,17,32,58,0],[34,17,37,46,0],[38,9,38,10,0],[41,9,41,10,0],[42,13,42,39,0],[43,13,43,14,0],[44,17,45,42,0],[46,17,46,18,0],[47,21,47,46,0],[48,21,48,44,0],[49,21,49,56,0],[50,21,51,47,0],[52,25,52,42,0],[53,21,53,68,0],[54,25,57,49,0],[58,17,58,18,0],[60,17,60,18,0],[61,21,61,47,0],[62,17,62,18,0],[63,13,63,14,0],[65,13,65,14,0],[66,17,66,43,0],[67,13,67,14,0],[68,9,68,10,0],[71,9,71,10,0],[72,13,72,97,0],[73,9,73,10,0],[76,9,76,10,0],[77,13,77,54,0],[78,9,78,10,0],[86,47,86,60,0],[87,9,87,10,0],[88,9,88,10,0],[90,34,90,38,0],[90,39,90,51,0],[92,34,92,38,0],[92,39,92,51,0],[96,9,96,10,0],[97,13,97,43,0],[98,17,98,60,0],[99,18,99,48,0],[100,17,100,60,0],[101,18,102,45,0],[103,17,103,58,0],[105,9,105,10,0],[108,9,108,10,0],[109,13,109,39,0],[110,13,110,14,0],[111,17,112,55,0],[113,17,113,18,0],[114,21,114,46,0],[115,21,115,44,0],[116,21,116,56,0],[117,21,117,75,0],[118,21,118,22,0],[120,25,120,60,0],[121,29,121,43,0],[124,29,124,43,0],[125,21,125,22,0],[127,21,127,47,0],[128,25,128,42,0],[130,21,130,68,0],[131,25,134,49,0],[135,17,135,18,0],[136,13,136,14,0],[138,13,138,14,0],[139,17,139,43,0],[140,13,140,14,0],[141,9,141,10,0]]);
    </script>
  </body>
</html>