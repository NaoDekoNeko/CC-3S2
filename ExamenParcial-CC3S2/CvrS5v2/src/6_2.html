<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Ademar\OneDrive\Desktop\Practica1-C3S2\Sprint5\ReSOSgame\ReSOSgame\Game.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using static ReSOSgame.Board;

namespace ReSOSgame
{
    public abstract class Game
    {
        public Board Board;
        public ScoreValidator validator;

        public Game(Board board)
        {
            this.Board = board;
            validator = new ScoreValidator(board);
        }

        //public int Tamanio =&gt; board.Tamanio;
        public abstract void FinalGameState(); // Funcion que indica el estado final del game
        public abstract void MakeMove(int row, int col, Cell ficha); // Funcion para realizar un movimiento
    }

    public class SimpleGame : Game
    {
        public SimpleGame(Board board) : base(board)
        {
        }

        // Funcion que verifica si se ha ganado el game simple
        // Funcion que actualiza el estado del game Simple 
        public override void FinalGameState()
        {
            if (validator.FullBoard())
                Board.EstadoDeJuego = GameState.EMPATE;
            else
                Board.EstadoDeJuego =
                    Board.Turn == Jugador.JAZUL
                        ? GameState.GANOAZUL
                        : GameState.GANOROJO; // Cambia el estado del board
        }

        public override void MakeMove(int row, int column, Cell _ficha)
        {
            if (!validator.GameOver()) // Si es el estado de game es JUGANDO
            {
                if (isOnBoard(row, column) &amp;&amp;
                    isEmpty(row, column)) // Si la posicion :[row,column] esta en el trablero y esa posicion esta vacia
                {
                    Board.ValidMove = true; // El atributo ValidMove es verdadero. 
                    Board.Ficha = _ficha; // rellena el atributo Ficha
                    Board.Grid[row, column] = _ficha; // rellena el grid del board con ficha
                    if (validator.HasOnePoint(row, column, Board.Ficha) ||
                        validator.FullBoard()) // Cuando se ha hecho ganado 1 punto o esta el board lleno
                        FinalGameState(); // Actualiza el estado final del board
                    if (Board.EstadoDeJuego == GameState.JUGANDO) // Si el estado de game es JUGANDO entonces ...
                        Board.Turn =
                            Board.Turn == Jugador.JAZUL
                                ? Jugador.JROJO
                                : Jugador.JAZUL; // Se hace el cambio de turno
                }
                else
                {
                    Board.ValidMove = false;
                }
            }
            else
            {
                Board.ValidMove = false;
            }
        }

        private bool isOnBoard(int row, int column)
        {
            return row &gt;= 0 &amp;&amp; row &lt; Board.Tamanio &amp;&amp; column &gt;= 0 &amp;&amp; column &lt; Board.Tamanio;
        }

        private bool isEmpty(int row, int column)
        {
            return Board.GetCell(row, column) == 0;
        }
    }


    public class GeneralGame : Game
    {
        // Atributos para tener los puntajes de cada jugador

        public GeneralGame(Board board) : base(board)
        {
        }

        public int PuntajeAzul { get; private set; }

        public int PuntajeRojo { get; private set; }
        // Funcion que verifica si se ha ganado en un Game General

        public override void FinalGameState() // Calcula el estado final comparando los puntajes
        {
            if (PuntajeAzul &gt; PuntajeRojo)
                Board.EstadoDeJuego = GameState.GANOAZUL; // Establece que el azul ha ganado
            else if (PuntajeAzul &lt; PuntajeRojo)
                Board.EstadoDeJuego = GameState.GANOROJO; // Establece que el rojo ha ganado
            else if
                (PuntajeRojo == PuntajeAzul)
                Board.EstadoDeJuego = GameState.EMPATE; // Establece que ha habido un empate
            //sino, el estado de game es JUGANDO
        }

        public override void MakeMove(int row, int column, Cell _ficha)
        {
            if (!validator.GameOver())
            {
                if (row &lt; 0 || row &gt;= Board.Tamanio || column &lt; 0 || column &gt;= Board.Tamanio
                    || Board.Grid[row, column] != 0) return;
                Board.ValidMove = true;
                Board.Ficha = _ficha;
                Board.Grid[row, column] = _ficha;
                if (validator.HasOnePoint(row, column, Board.Ficha)) // Si se ha obtenido un punto
                {
                    //en el turno del jugador JAZUL
                    if (Board.Turn == Jugador.JAZUL)
                        PuntajeAzul++; // Se agrega un punto al jugador Azul
                    //en el turno del jugador JROJO
                    else
                        PuntajeRojo++; // Se agrega un punto al jugador Rojo
                }

                if (validator.FullBoard())
                    FinalGameState(); // Actualiza el estado del game cuando el board esta lleno
                // Nota: esa funcion detiene el cambio de turno cuando ya se halla ganado o empatado
                if (Board.EstadoDeJuego == GameState.JUGANDO) // Si se sigue jugando
                    Board.Turn =
                        Board.Turn == Jugador.JAZUL
                            ? Jugador.JROJO
                            : Jugador.JAZUL; // Se cambia de turno al jugador contrario
            }
            else
            {
                Board.ValidMove = false;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[10,9,10,33,1],[11,9,11,10,1],[12,13,12,32,1],[13,13,13,51,1],[14,9,14,10,1],[23,42,23,53,1],[24,9,24,10,1],[25,9,25,10,1],[30,9,30,10,1],[31,13,31,39,1],[32,17,32,56,1],[34,17,37,46,1],[38,9,38,10,1],[41,9,41,10,1],[42,13,42,39,1],[43,13,43,14,1],[44,17,45,42,1],[46,17,46,18,1],[47,21,47,44,1],[48,21,48,42,1],[49,21,49,54,1],[50,21,51,47,1],[52,25,52,42,1],[53,21,53,66,1],[54,25,57,49,1],[58,17,58,18,1],[60,17,60,18,0],[61,21,61,45,0],[62,17,62,18,0],[63,13,63,14,1],[65,13,65,14,0],[66,17,66,41,0],[67,13,67,14,0],[68,9,68,10,1],[71,9,71,10,1],[72,13,72,93,1],[73,9,73,10,1],[76,9,76,10,1],[77,13,77,52,1],[78,9,78,10,1],[86,43,86,54,1],[87,9,87,10,1],[88,9,88,10,1],[90,34,90,38,1],[90,39,90,51,1],[92,34,92,38,1],[92,39,92,51,1],[96,9,96,10,1],[97,13,97,43,1],[98,17,98,58,1],[99,18,99,48,1],[100,17,100,58,1],[101,18,102,45,1],[103,17,103,56,1],[105,9,105,10,1],[108,9,108,10,1],[109,13,109,39,1],[110,13,110,14,1],[111,17,112,53,1],[112,54,112,61,0],[113,17,113,40,0],[114,17,114,38,0],[115,17,115,50,0],[116,17,116,69,0],[117,17,117,18,1],[119,21,119,53,0],[120,25,120,39,0],[123,25,123,39,0],[124,17,124,18,1],[126,17,126,43,0],[127,21,127,38,0],[129,17,129,62,0],[130,21,133,45,0],[134,13,134,14,1],[136,13,136,14,0],[137,17,137,41,0],[138,13,138,14,0],[139,9,139,10,1]]);
    </script>
  </body>
</html>